<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Restablecer Contraseña - Centro Pokémon</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://fonts.cdnfonts.com/css/press-start-2p" rel="stylesheet">
        <style>
            body {
                background-color: #9bbc0f;
                font-family: 'Press Start 2P', cursive;
                color: #0f380f;
                text-transform: uppercase;
            }
            .gameboy-card {
                max-width: 500px;
                background-color: #8bac0f;
                border: 5px solid #306230;
                border-radius: 10px;
                padding: 25px;
                box-shadow: 8px 8px 0 #0f380f;
            }
            input.form-control {
                background-color: #c3e88d;
                border: 2px solid #306230;
                color: #0f380f;
                font-family: 'Press Start 2P', cursive;
                font-size: 10px;
            }
            .btn-poke {
                background-color: #306230;
                border: 2px solid #0f380f;
                color: #c3e88d;
                text-transform: uppercase;
                transition: 0.2s;
            }
            .btn-poke:hover {
                background-color: #0f380f;
                color: #9bbc0f;
            }
            .poke-logo {
                width: 90px;
                display: block;
                margin: 0 auto 20px;
            }
        </style>
    </head>
    <body class="d-flex align-items-center justify-content-center vh-100">

        <div class="gameboy-card text-center">
            <img src="https://pngimg.com/uploads/pokeball/pokeball_PNG21.png" class="poke-logo" alt="Pokéball">

            <h4>Restablecer Contraseña</h4>
            <p class="mt-2 mb-4" style="font-size: 10px;">Ingresa tu nueva contraseña</p>

            <form th:action="@{/usuario/resetPassword}" method="post">
                <input type="hidden" name="token" th:value="${token}">
                <div class="mb-3 text-start">
                    <label class="form-label">Nueva Contraseña</label>
                    <input type="password" name="password" class="form-control" required>
                    <small class="err-msg text-danger small" id="password-msg"></small>

                </div>
                <div class="mb-3 text-start">
                    <label class="form-label">Confirmar Contraseña</label>
                    <input type="password" name="confirmPassword" class="form-control" required>
                    <small class="err-msg text-danger small" id="confirmPassword-msg"></small>

                </div>
                <button type="submit" id="submitPasswordBtn" class="btn btn-poke w-100">Guardar</button>
            </form>

            <p class="mt-3" style="font-size: 10px;">
                <a th:href="@{/usuario/login}" class="text-dark text-decoration-none">Volver al login</a>
            </p>
        </div>
        <script>
            $(document).ready(function () {
                let isPasswordValid = false;
                let doPasswordsMatch = false;

                function updateSubmitButton() {
                    if (isPasswordValid && doPasswordsMatch) {
                        $("#submitPasswordBtn").prop("disabled", false);
                    } else {
                        $("#submitPasswordBtn").prop("disabled", true);
                    }
                }

                function validatePasswords() {
                    let regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
                    let password = $("#password").val();
                    let confirmPassword = $("#confirmPassword").val();

                    // Validar formato de contraseña
                    if (password.length > 0) {
                        if (regex.test(password)) {
                            $("#password-msg")
                                    .text("✓ Contraseña válida")
                                    .removeClass("text-danger")
                                    .addClass("text-success");
                            isPasswordValid = true;
                        } else {
                            $("#password-msg")
                                    .text("Debe tener al menos 8 caracteres, una mayúscula, una minúscula, un número y un símbolo (@$!%*?&)")
                                    .removeClass("text-success")
                                    .addClass("text-danger");
                            isPasswordValid = false;
                        }
                    } else {
                        $("#password-msg").text("");
                        isPasswordValid = false;
                    }

                    // Validar que coincidan
                    if (confirmPassword.length > 0) {
                        if (password === confirmPassword && password.length > 0) {
                            $("#confirmPassword-msg")
                                    .text("✓ Las contraseñas coinciden")
                                    .removeClass("text-danger")
                                    .addClass("text-success");
                            doPasswordsMatch = true;
                        } else {
                            $("#confirmPassword-msg")
                                    .text("Las contraseñas no coinciden")
                                    .removeClass("text-success")
                                    .addClass("text-danger");
                            doPasswordsMatch = false;
                        }
                    } else {
                        $("#confirmPassword-msg").text("");
                        doPasswordsMatch = false;
                    }

                    updateSubmitButton();
                }

                $("#password, #confirmPassword").on("input", validatePasswords);

                // Inicializar botón como deshabilitado
                updateSubmitButton();
            });
        </script>
    </body>
</html>
